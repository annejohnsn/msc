In the previous chapter, we explored in detail the final Corollary of Chapter 2. This corollary lead us to study the lattice of closed balls in $S$, which we called $T_S$. In this chapter, we take what we have learned and explore the preceding Corollary, repeated below.\\

\begin{corollary*}
	Suppose $S = \cup_i^n S_i$ with $\rho(S_i, S_j)=d=diam(S)$ and also $\omega(S_i)=\omega(S_j)$, $\forall i,j$.  Let $r \in \mathbb{R}$ be such that $\omega(S_i)=r\omega(S)$, $\forall i$. Then $\omega(S) = r^{\frac{1}{n-1}}$. 
\end{corollary*}

In particular, we seek answers to the following questions: when does such a partition of $S$ exist and given such a partition, when are we able to compute the scaling factor $r$? In doing so, we show that the structure of $T_S$ plays an important role. 


\section{Semi-regularity}
In this section, we restrict to the case where in the tree $T_s$, for $S$ a compact, discretely-valued subset of an ultrametric space, every vertex on a given level has the same number of children. In this case, we can attach another sequence to $S$, which we call the $\alpha-$sequence of $S$ and which describes, for each level $k \in \mathbb{N}$, the size of the partitions on that level. We develop some preliminary lemmas, which we then use to derive formulae for this special case. This situation corresponds to what previous authors (\cite{amice}, \cite{cef}, \cite{fp}) have called \textit{regularity}, a term which we reserve for the next section. 

\begin{definition}
Let $S$ be as before, a compact, discretely-valued subset of an ultrametric space $(M, \rho)$. We say that $S$ is \textbf{semi-regular} if $T_{B^k_i} \cong T_{B^k_j}$, $\forall k \in \mathbb{N}$ and  $i,j \in \beta(k)$, and where the isomorphism is understood as an isomorphism of trees. That is, $S$ is semi-regular if each ball of radius $\gamma_k$ breaks into the same number of balls of radius $\gamma_{k+1}$, for all $k$. If there exists an $n \in \mathbb{N}$ such that $T_{B^N_i} \cong T_{B^N_j}$ for all $N \geq n$, that is,  each ball of radius $\gamma_N$ breaks into the same number of balls of radius $\gamma_{N+1}$ for $N \geq n$, then we say $S$ is \textbf{eventually semi-regular}.
\end{definition}

\begin{definition}
Suppose $S$ is a compact, discretely-valued subset of an ultrametric space and $S$ is semi-regular. The \textbf{$\alpha$-sequence} of $S$ is the sequence given by \[\alpha(k)=\frac{\beta(k+1)}{\beta(k)}\] which is in $\mathbb{N}$ for each $k$. That is, if $B^k_i$ is any element of $S_{\gamma_k}$, then $\alpha(k)$ is equal to the number of children of $B^k_i$ in $T_s$. Since $S$ is semi-regular, this number does not depend on $i$.
\end{definition}

\begin{example}
\label{lagrange}	
	If $G$ is a compact ultrametric space and also a group, each ball centred at $0$ is in fact a subgroup of $G$. Then each set of elements of $S_{\gamma_k}$ is a collection of cosets of $G/B(0,\gamma_k)$. Since $G$ is assumed to be compact, $G/B(0,\gamma_k)$ is finite and so Lagrange's theorem implies that $G$ is semi-regular.
\end{example}

We now work towards a formula for the terms in the $\rho-$sequence of a semi-regular space $S$. We need a few lemmas to get started.\\
 
\begin{lemma}
Let $n$ and $q$ be in $\mathbb{N}$. Then $\lfloor\frac{n}{q} \rfloor$ counts the numbers strictly less than $n$ that are congruent to $n \mod q$.
\end{lemma}

\begin{proof}
By the division algorithm, we know there exists unique $c,r \in \mathbb{Z}$ such that \[n = cq + r\] with $0 \leq r < q$. Since $c$ counts the number of $q$-multiples in the set $\{1,\ldots,n-1\}$, and each $q$-multiple contains exactly one element that is congruent to $n \mod q$, we need only show $\lfloor\frac{n}{q} \rfloor = c$. Simply note that the above implies  \[\frac{n}{q} = c + \frac{r}{q}\] and we must have   $\frac{r}{q} < 1$. Then $c$ is the largest integer such that $\frac{n}{q} \leq c$, but this is the definition of $\lfloor\frac{n}{q} \rfloor$.
\end{proof}


\begin{lemma}
\label{semi-regular formula}
\[\lfloor\frac{n}{b} \rfloor - \lfloor \frac{n}{ab} \rfloor = \sum_{k=1}^{a-1} \lfloor \frac{n + kb}{ab} \rfloor\] for $n,a,b \in \mathbb{N}$. In particular, 
\[\lfloor\frac{n}{b} \rfloor - \lfloor \frac{n}{2b} \rfloor= \lfloor \frac{n+b}{2b} \rfloor\] for  $n,b \in \mathbb{N}$.
\end{lemma}

\begin{proof}
\[\lfloor\frac{n}{b} \rfloor - \lfloor \frac{n}{ab} \rfloor = \lfloor a \cdot \frac{n}{ab} \rfloor - \lfloor \frac{n}{ab} \rfloor  = \sum_{k=0}^{a-1} \lfloor \frac{n}{ab} + \frac{k}{a} \rfloor - \lfloor \frac{n}{ab} \rfloor \text{ (*)}\]
\[= \sum_{k=1}^{a-1} \lfloor \frac{n}{ab} + \frac{k}{a} \rfloor = \sum_{k=1}^{a-1} \lfloor \frac{n + kb}{ab} \rfloor \]
where the final step in (*) is due to Hermite's identity: $\lfloor nx \rfloor = \sum_{k=0}^{n-1} \lfloor x + \frac{k}{n} \rfloor$, for $n \in \mathbb{N}$ and $x \in \mathbb{R}$.
\end{proof}                                                                                                              

\begin{lemma}
If $S$ is semi-regular and $\sigma$ denotes the canonical $\rho$-ordering of $S$, that is, a $\rho-$ordering formed by pulling from left to right in $T_s$, then \[\rho(\sigma(n),\sigma(m))=\gamma_k\] if and only if \[ n=m \mod \beta(k) \text{  and } n \neq m \mod \beta(k+1)\]
\end{lemma}

\begin{proof}
Since $S$ is semi-regular, every sequence of $\beta(k)$ terms in $\sigma$ will be from each of distinct elements of $S_{\gamma_k}$ (for any $k$). Moreover, since $\sigma$ is a canonical $\rho-$ordering, we always pull from the elements of $S_{\gamma_k}$ in the same order. Then $\sigma(n)$ and $\sigma(m)$ are descendents of some $B^k_j$ if and only if $n = m \mod \beta(k)$. Then the result follows since $\rho(\sigma(n),\sigma(m))=\gamma_k$ if and only if $B^k_i$ for some $i \in 1,\ldots, \beta(k)$ is the join of $B^n_i \ni \sigma(n)$ and $B^m_{i'} \ni \sigma(m)$.  \\ 
\end{proof}

We introduce another piece of notation before continuing.

\begin{notation}
	Let $S$ be a compact, discretely-valued subset of an ultrametric space, $\Gamma_S$ the set of distances in $S$ and $\delta(n)$ the characteristic sequence of $S$. Suppose $\gamma_k$ is an element of $\Gamma_S$. Then we denote by $v_{\gamma_k}(\delta(n))$ the exponent of $\gamma_k$ in the $n^{th}-$term of the characteristic sequence of $S$.
\end{notation}

\begin{proposition}
If $S$ is a semi-regular ultrametric space, $\delta$ is the characteristic sequence of $S$, $\beta$ is the structure sequence of $S$, and $\alpha$ is the sequence describing the semi-regularity, then
\[v_{\gamma_k}(\delta(n)) =  \lfloor\frac{n}{\beta(k)}\rfloor - \lfloor\frac{n}{\beta(k+1)}\rfloor = \sum_{j=1}^{\alpha(k)-1} \lfloor \frac{n + j\cdot \beta(k)}{\alpha(k)\beta(k)} \rfloor\]
\end{proposition}

\begin{proof}
The exponent of $\gamma_k$ in the $n^{th}$ term of the characteristic sequence is the number of $m$ strictly less than $n$ such that $\rho(\delta(n),\delta(m))=\gamma_k$. By the lemma above, this the number of $m <n$ such that $m = n \mod \beta(k)$  and $m \neq n \mod \beta(k+1)$, which by the previous lemma is $\lfloor\frac{n}{\beta(k)}\rfloor - \lfloor\frac{n}{\beta(k+1)}\rfloor$. Then we have:
\begin{flalign*}
 v_{\gamma_k}(\delta(n)) & \\
 = \lfloor\frac{n}{\beta(k)}\rfloor - \lfloor\frac{n}{\beta(k+1)}\rfloor & \\
 = \lfloor\frac{n}{\beta(k)}\rfloor - \lfloor\frac{n}{\beta(k)\alpha(k)}\rfloor\text{,} & \text{ because } S \text{ is semi-regular}\\
 = \sum_{j=1}^{\alpha(k)-1} \lfloor \frac{n + j\cdot \beta(k)}{\alpha(k)\beta(k)} \rfloor
\end{flalign*}
\end{proof}



\begin{example}
\label{legendre}
Consider the ultrametric space $(\mathbb{Z}, \rho_p)$  for any prime $p$. Then $\beta(k)=p^k$ and $\alpha(k)=p$ for any $k \in \mathbb{N} \cup 0$. The above gives 
\[v_{\gamma_k}(\delta(n)) =\lfloor \frac{n}{p^{k}}\rfloor - \lfloor \frac{n}{p^{k+1}} \rfloor\]
Now since $\gamma_k = p^{-k}$, $\forall k$, we are able to compute the exponent of $\frac{1}{p}$ in $\delta(n)$. We have 
\[v_{\frac{1}{p}}(\delta(n)) \]
\[ = \sum_{k=1}^{\infty} k \cdot (\lfloor \frac{n}{p^{k}}\rfloor - \lfloor \frac{n}{p^{k+1}} \rfloor) \]
\[ = \sum_{k=1}^{\lceil log_p(n) \rceil}  k \cdot (\lfloor \frac{n}{p^{k}}\rfloor - \lfloor \frac{n}{p^{k+1}} \rfloor)\]
\[ = \lfloor \frac{n}{p}\rfloor - \lfloor \frac{n}{p^{2}} \rfloor +  2\lfloor \frac{n}{p^2}\rfloor - 2\lfloor \frac{n}{p^3} \rfloor + \ldots +  \lceil log_p(n)\rceil \lfloor \frac{n}{p^{ \lceil log_p(n)\rceil}} \rfloor \]
\[ = \lfloor \frac{n}{p}\rfloor + \lfloor \frac{n}{p^2}\rfloor  + \ldots +  \lfloor \frac{n}{p^{ \lceil log_p(n)\rceil}} \rfloor \]
\[ =  \sum_{k=1}^{\lceil log_p(n) \rceil} \lfloor \frac{n}{p^{k}}\rfloor \]
\[ =  \sum_{k=1}^{\infty} \lfloor \frac{n}{p^{k}}\rfloor \]

We are able to simplfy to a finite sum in the above because $\lfloor \frac{n}{p^k} \rfloor = 0$ if \[ p^k > n \iff log(p^k) > log(n) \iff k > log_p(n)\]
We have already seen that the natural order on the integers gives a $\rho_p$-ordering for each $p$. So then \[\sum_{k=1}^{\infty} \lfloor \frac{n}{p^{k}}\rfloor= v_{\frac{1}{p}}(\delta(n)) = v_{\frac{1}{p}}(\prod_{i=0}^n \frac{1}{p}^{v_p(n-i)}) = \sum_{i=0}^{n-1} v_p(n-i)= v_{p}(n!)  \]
so that we are able to recover the well-known Legendre's formula.\\
\end{example}

We end this section with the following observation.

\begin{proposition}
	Let $S$ be a semi-regular subset of an ultrametric space $(M,\rho)$. Let $S_{\gamma_1}$ be the partition of $S$ described in chapter $3$, that is,
	\[S_{\gamma_1} = \bigcup_{i=1}^{b} B(x_i,\gamma_1) = \bigcup_{i=1}^{n} B^1_i\]
	Then $\rho(B^1_i, B^1_j) = d = diam(S)$ for any $i \neq j$ in $1,\ldots,n$ and $\omega( B^1_i) = \omega( B^1_j)$ for all $i$ and $j$.
\end{proposition}

\begin{proof}
	The fact that  $\rho(B^1_i, B^1_j) = d = diam(S)$ for any $i \neq j$ is clear and does not depend on the fact that $S$ is semi-regular. In fact, there are plently of ways to see this, but for example, we simply note $\rho(B^1_i, B^1_j) \in \Gamma_S$  and $ \gamma_1 < \rho(B^1_i, B^1_j)\leq \gamma_0 = diam(S)$.\\
	
	To see that $\omega( B^1_i) = \omega( B^1_j)$, we note that since $S$ is semi-regular, each $B^1_i$ is semi-regular as well. Moreover, since $S$ is semi-regular, the $\beta$ sequences of $B^1_i$ and $B^1_j$ are the same for each $i$ and $j$. Then the result follows: let $\delta^{B^1_i}(n)$ and $\delta^{B^1_j}(n)$ be the characteristic sequences of $B^1_i$ and $B^1_j$ respectively. We see that for all $k$,
	  
	  \[v_{\gamma_k}(\delta^{B^1_i}(n)) =  \lfloor\frac{n}{\beta^B(k)}\rfloor - \lfloor\frac{n}{\beta^B(k+1)}\rfloor =  v_{\gamma_k}(\delta^{B^1_j}(n)) \]
	where $\beta^B(k)$ is the $\beta$ sequence for each  $B^1_i$.
	 
\end{proof}

Now we have one answer to our first question: when $S$ is semi-regular, we can use the elements of $S_{\gamma_1}$ to build the partition from the corollary. The content of that corollary gave a formula for the valuative capacity. Then if $S$ is semi-regular, the principal obstacle to computing the capacity of $S$ is the identification of the scaling factor. This leads to our second question: when can we compute $r$?

\section{Regularity}
In Example \ref{legendre}, the fact that we were able to reduce to a finite sum was not the only reason we were able to simplfy the calculations. It also helped a great deal that the sum was telescoping. What does the fact that we saw a telescoping sum have to do with computing the scaling factor $r$? We explore the inter-relatedness of these situations, and with the definition below, in this section.

\begin{definition}
Let $S$ be a semi-regular subset of an ultrametric space. If there exists a $q \in \mathbb{N}$ such that $\alpha(n) = q$, for all $n$, then $S$ is said to be \textbf{regular}\footnote{This is non-standard: what previous authors (\cite{amice},\cite{cef}, \cite{fp}) have called regular is what we have called semi-regular. Note that $S$ is regular in the present sense if and only if $T_S$ is regular in the standard graph theory terminology.}. %If there exists a $q \text{ and } N$ in $\mathbb{N}$ such that $\alpha(n) = q$, for all $n \geq N$, then $S$ is said to be $\textbf{eventually regular}$.
\end{definition}

%Alt:
%\begin{definition}
%Let $S$ be a semi-regular compact subset of an ultrametric space. If there exists a $q_1,\ldots,q_m \in \mathbb{N}$ such that $\alpha(n) = q_i$ if, and only if, $n = i \mod m$, that is, $\alpha$ has an infinitely-repeating finite subsequence of length $m$, then we say $S$ is $\textbf{periodic}$. If $m=1$, then $S$ is $\textbf{regular}$. 
%\end{definition}

So then $S$ is regular just in case $S$ is semi-regular and the $\alpha-$sequence of $S$ is constant. We need to make one more definition before we begin calculations. \\

\begin{definition}
Let $S$ be a semi-regular subset of an ultrametric space and $\Gamma_S$ is the sequence of decreasing distances in $S$. Then we say $S$ is \textbf{tame}, if for $\gamma_k \in \Gamma_S$, \[\gamma_k = \alpha(k)^{c_k}\] for some $c_k \in \mathbb{Q}$ and for all $k \in \mathbb{N}$.
\end{definition}

Now we see what this situation means for calculations.\\

\begin{proposition}
	Let $S$ be a regular, tame subset of a compact ultrametric space with $\gamma_k = q^{c_k}$ for some $c_k \in \mathbb{Q}$ and for all $k \in \mathbb{N} \cup 0$. Then 
	\[v_{q}(\delta(n)) =  c_0n + \sum_{k=1}^{\infty} (c_{k} - c_{k-1}) \cdot \lfloor\frac{n}{q^{k}}\rfloor \]
	 and 
	\[log_q(\omega(S)) = \lim_{n\to\infty} c_0 + \frac{1}{n}\sum_{k=1}^{\infty} (c_{k} - c_{k-1}) \cdot \lfloor\frac{n}{q^{k}}\rfloor  \]
\end{proposition}

\begin{proof}
	We know that,
\[v_{\gamma_k}(\delta(n)) =  \lfloor\frac{n}{q^k}\rfloor - \lfloor\frac{n}{q^{k+1}}\rfloor \]
and since $\gamma_k = q^{c_k}$, we calculate
\[v_{q^{c_k}}(\delta(n)) =  \lfloor\frac{n}{q^k}\rfloor - \lfloor\frac{n}{q^{k+1}}\rfloor \]
and
\[v_{q}(\delta(n)) =  \sum_{k=0}^{\infty} c_k \cdot(\lfloor\frac{n}{q^k}\rfloor - \lfloor\frac{n}{q^{k+1}}\rfloor) \]
%\[=  \sum_{k=0}^{\lceil log_q(n) \rceil} c_k \cdot(\lfloor\frac{n}{q^k}\rfloor - \lfloor\frac{n}{q^{k+1}}\rfloor) \]
%\[=  c_0n - c_0\lfloor\frac{n}{q}\rfloor + c_1\lfloor\frac{n}{q}\rfloor - c_1\lfloor\frac{n}{q^{2}}\rfloor  + c_2\lfloor\frac{n}{q^2}\rfloor - c_2\lfloor\frac{n}{q^{3}}\rfloor \ldots - c_{\lceil log_q(n) \rceil} \lfloor\frac{n}{q^{\lceil log_q(n) \rceil}}\rfloor + \lceil log_q(n) \rceil\lfloor\frac{n}{q^{\lceil log_q(n) \rceil}}\rfloor  \]
%\[= c_0n + \sum_{k=1}^{\lceil log_q(n) \rceil} (c_{k} - c_{k-1}) \cdot \lfloor\frac{n}{q^{k}}\rfloor \]
\[=  c_0n + \sum_{k=1}^{\infty} (c_{k} - c_{k-1}) \cdot \lfloor\frac{n}{q^{k}}\rfloor \]
Then since $\omega(S) = \lim_{n\to\infty} \delta(n) ^{\frac{1}{n}}$,
\[log_q(\omega(S)) = log_q(\lim_{n\to\infty} \delta(n) ^{\frac{1}{n}}) = log_q(\lim_{n\to\infty}q^{{c_0n + \sum_{k=1}^{\infty} (c_{k} - c_{k-1}) \cdot \lfloor\frac{n}{q^{k}}\rfloor}^{\frac{1}{n}}})\]
 \[=\lim_{n\to\infty} c_0 + \frac{1}{n}\sum_{k=1}^{\infty} (c_{k} - c_{k-1}) \cdot \lfloor\frac{n}{q^{k}}\rfloor \] 
\end{proof}

Let us make a small digression, motivated by the following observation: if, as in the case of $p-$adic spaces, $c_i=-i$ for all $i$, then the above simply reduces to $lim_{n\to\infty} \frac{v_q(n!)}{n} $. Moreover, we know that $\{0,1,2,\ldots\}$ is simultaneously a $p-$ordering of $\mathbb{Z}$ (with $p-$sequence $v_p(n!)$) for all primes $p$. 

\begin{question}
	Let $M$ be a set and suppose $\rho_j$ is collection of ultrametrics on $M$ such that each $(M,\rho_j)$ is regular and tame with $c_i-c_{i+1}=c$ for some constant $c$, for all $i$ and for each $j$. Then if $\{a_i\}_{i \geq 0 }$ is a $\rho_j$-ordering of $(M,\rho_j)$ for some $j$, is $\{a_i\}_{i \geq 0 }$ simultaneously a $\rho_j$-ordering for all $j$? In particular, if $S$ is a subset of $\mathbb{Z}$, does $S$ being regular imply that $S$ has simultaneous $p-$ordering for each prime $p$?
\end{question}

We return now to the question at hand. If $S$ is semi-regular, we have already seen that the partition of $S$ given by the elements of $S_{\gamma_1}$ is such that each element has equal capacity and the pairwise distance between them is equal to the diameter of $S$. Now we notice that if $S$ is regular and tame, then so is $B(x_i,\gamma_1)$ for each $i$. This gives us, 

\[log_q(\omega(B(x_i,\gamma_1))) = \lim_{n\to\infty} c_1 + \frac{1}{n}\cdot \sum_{k=1}^{\infty} (c_{k+1} - c_{k}) \lfloor \frac{n}{q^{k}}\rfloor\]

Putting these together, we can solve for the scaling factor.
If \[\omega(S) = r\cdot \omega(B)\] then
\[ log_q(r) = \lim_{n\to\infty} c_0 + \frac{1}{n} \sum_{k=1}^\infty (c_k - c_{k-1}) \lfloor \frac{n}{q^k} \rfloor -  c_1 - \frac{1}{n}\cdot \sum_{k=1}^{\infty} (c_{k+1} - c_{k}) \lfloor \frac{n}{q^{k}}\rfloor\]
\[ = \lim_{n\to\infty} c_0 -c_1 + \frac{1}{n} \sum_{k=1}^\infty (c_k - c_{k-1}) - (c_{k+1} - c_{k}) \lfloor \frac{n}{q^k} \rfloor \]

When do we know the value of this limit? One case is obvious, namely the case where $(c_{k+1} - c_{k}) = (c_{k} - c_{k-1})$, which is guarenteed if the distances between each $c_k$ and $c_{k+1}$ is constant. In this case, we see right away that the scaling factor $r$ is equal to $q^{c_0-c_1}$. In particular, this gives an alternate proof for the fact that $p \cdot \omega(p\mathbb{Z}) = \omega(\mathbb{Z})$ and one which does not rely (directly) on any algebraic structure. \\

It is now clear that if we want to get the most leverage out of regularity, we need more assumptions on our space than we did for semi-regularity. We have seen something like this before. If $S$ is a group with translation invariant metric, we can use translation invariance right away. It implies the cosets of $S$ modulo balls centred at $0$ all have the same capacity, which allows us to simplify the right-hand side of the subadditivity formula. If $S$ has a multiplicative norm though, there is one situation in which this property is distinctly more useful. That is, we get the most use out of a multiplicative norm when the subgroups corresponding to the balls centered at $0$ are cyclic.\\% We have one more question, before offering some concluding remarks.\\

%\begin{question}
%	Let $(M,\rho_N)$ be an ultrametric space with metric induced by a multiplicative norm $N$. Then $M$ is a normed vector space, in particular a group, so that $M$ is semi-regular. Suppose $M$ is also tame with $\gamma_k=\alpha(k)^{c_k}$ for all $k$ in $\mathbb{N} \cup 0$. If $B(0,\gamma_1)$ is cyclic, then does $c_{k} - c_{k-1} = c$ for some constant $c$ and all $k \in \mathbb{N}$? If $B(0,\gamma_1)$ is a finitely-generated subgroup of $S$, then is the set $\{c_{k} - c_{k-1}; k \in \mathbb{N}\}$ also finite? 
%\end{question}

When $S$ is an ultrametric space with algebraic structure, translation invariance and scaling under a norm can be very effective tools for computing capacity. The results of this chapter give us  a sense in which we can generalize this toolkit. Indeed, semi-regularity and regularity respectively provide the analogous notions. Semi-regularity implies the presence of a sort of ``well-balanced" partition of $S$ that we can use in the subadditivity formula. Likewise, regularity shows us that we can recover a notion of scaling, although as with a multiplicative norm, to get the most out of this, the conditions have to be right. 



%\begin{corollary}
%If $S$ is a (eventually) semi-regular ultrametric space and the $\alpha$ sequence of $S$ is (eventually)  periodic, then the valuative capacity of $S$ is algebraic.
%\end{corollary}

%\begin{corollary}
%Suppose $S$ and $T$ are compact subsets of an ultrametric space $M$ with $\Gamma_S = \Gamma_T$ and $\mid S_{\gamma_k}\mid =\mid T_{\gamma_k}\mid$, $\forall k$. Then $\omega(S) = \omega(T)$. 
%\end{corollary}
%\begin{itemize}
%\item i think this coincides with translation invariance when there is a group operation
%\end{itemize}


%Semi-regularity in $S$ reflects horizontal similarity on every level of $T_S$, and so we expect semi-regularity to simplify the calculation of valuative capacity.

%\begin{proposition}
%Let $S$ be a semi-regular, compact subset of an ultrametric space. Let $\Gamma_S$ be the set of distances in $S$ and let $B$ be the first element of $S_{\gamma_1}$. Let $\sigma^S(i)$  be the characteristic sequence of $S$ and $\sigma^B(i)$ be the characteristic sequence of $B$. Then,

%\[\sigma^S(\beta(0) \cdot n)=\gamma_0^c \cdot \sigma^{B}(n)\]

%where $c$ counts the numbers in $1$ to $\beta(0) \cdot n$ that are not divisible by $\beta(0)$.

%\end{proposition}

%\begin{proof}
%(sketch)
%If $n=0$, then $c=0$ and $\beta(0) \cdot n = 0$, and,
%\[\sigma^S(0)= 1 =	1 \cdot \sigma^{B}(0)\]
%since the $0^{th}$-term of any characteristic sequence is $1$ by definition. When $n=1$, $c=\beta(0)-1$, so that the right-hand side becomes,
%\[\gamma_0^{\beta(0)-1} \cdot \sigma^{B}(1)\]
%Now note that the $\beta(0)^{th}$ term of $\sigma^S$ will have $\beta(0)-1$ copies of $\gamma_0$ (one from each of the elements of $S_{\gamma_0}$ not containing the $\beta(0)^{th}$ element) and the remaining term is in the branch $B$, so it is given by $\sigma^B(1)$, and so,
%\[\sigma^S(\beta(0))=\gamma_0^{\beta(0)-1} \cdot \sigma^{B}(1)\]


%Suppose:
%\[\sigma^S(\beta(0) \cdot n)=\gamma_0^{c_n} \cdot \sigma^{B}(n)\]

%for $0 \leq n < n +1$ and consider $\sigma^S(\beta(0) \cdot (n+1))$. $\sigma^S(\beta(0) \cdot (n+1))$ will add $\beta(0)$ more terms to $\sigma^S(\beta(0) \cdot n)$. Moreover, exactly $\beta(0)-1$ of these additional terms will be in other branches and $1$ term will be in $B$, since any sequence of $\beta(0)$ terms in the $\rho-$ordering of $S$ will be from each of the $\beta(0)$ branches. Each of the $\beta(0)-1$ terms from other branches will add a copy of $\gamma_0$ and remaining term can be found by looking ahead in $\sigma^B$, so that

%\begin{align*}
%\sigma^S(\beta(0) \cdot (n+1)) && \\
%= \sigma^S(\beta(0) \cdot n) \cdot \gamma_0^{\beta(0)-1} \cdot \frac{\sigma^B(n+1)}{\sigma^B(n)} && \\
%= {\gamma_0^{c_n}} \cdot \sigma^{B}(n) \cdot \gamma_0^{\beta(0)-1} \cdot  \frac{\sigma^B(n+1)}{\sigma^B(n)} &&\\
%= {\gamma_0^{c_n}}  \cdot \gamma_0^{\beta(0)-1} \cdot  \sigma^B(n+1) && \\
%= {\gamma_0^{c_{n+1}}} \cdot  \sigma^B(n+1) 
%\end{align*}

%\end{proof}
%Since semi-regularity requires horizontal similarity at every level of $T_S$, we can repeat the branch cuts as many times as needed to calculate $\sigma(n)$.

